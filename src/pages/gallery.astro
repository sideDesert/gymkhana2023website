---
import { isHTMLString } from "astro/dist/runtime/server/escape";
import { map } from "nanostores";
import { isHTMLString } from "astro/dist/runtime/server/escape";
import Bar from '../components/Bar.astro'
import Layout from "../layouts/Layout.astro";
const window = 'p-1 image'
const imgClass = 'cursor-pointer'
const imgs = ['https://images.unsplash.com/photo-1672094053413-9f6e163fe086?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1974&q=80', 
              'https://images.unsplash.com/photo-1664575599618-8f6bd76fc670?ixlib=rb-4.0.3&ixid=MnwxMjA3fDF8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80',
              'https://images.unsplash.com/photo-1672071664623-d5d6744467e2?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1332&q=80',
              'https://images.unsplash.com/photo-1672130474132-4b3af9e4a36e?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2070&q=80',
              'https://images.unsplash.com/photo-1672092925983-a4b1dd47248d?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80',
              'https://images.unsplash.com/photo-1508873760731-9c3d0bb6b961?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80',
              'https://images.unsplash.com/photo-1521478898332-2bbe4dd4c045?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80',
              'https://images.unsplash.com/photo-1521245854987-d25295bbdff3?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=765&q=80',
              'https://images.unsplash.com/photo-1671877308526-ac799c88db13?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=687&q=80',
              'https://images.unsplash.com/photo-1521050356699-b7cb6cd9106a?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80',
              'https://images.unsplash.com/photo-1672103466605-008851339145?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=687&q=80',
              'https://images.unsplash.com/photo-1671566852010-67185f179793?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80']

const imgArrayData = JSON.stringify(imgs)
---
<Layout title={'Gallery'}>

    
    <div class="p-8">
        <div class="">
            <div class="bg-r h-[6px] w-full self-center mb-6">
                <div class="bg-p h-[6px] w-16 ml-16"></div>
            </div>
        </div>
        <h2 class="font-bold text-center text-6xl md:text-7xl md:text-left ">
            Gallery
        </h2>
    </div>
    <div class="flex flex-col md:flex-row mb-[5rem]">

        <div class="basis-[100%] md:basis-1/3">
            {imgs.map((Image,index)=>{
                if(index%3 === 0){
                    return <div class={window}>
                        <img class={imgClass} data-index={index} src={Image} alt="dummt">
                        </div>
                }
            })}
        </div>
        
        <div class="basis-[100%] md:basis-1/3">
            {imgs.map((Image,index)=>{
                if((index-1)%3 === 0){
                    return <div class={window}>
                        <img class={imgClass} data-index={index} src={Image} alt="dummt">
                        </div>
                }
            })}
        </div>   
        <div class="basis-[100%] md:basis-1/3">
            {imgs.map((Image,index)=>{
                if((index-2)%3 === 0){
                    return <div class={window}>
                        <img class={imgClass} data-index={index} src={Image} alt="dummt">
                        </div>
                }
            })}    
        </div>
    </div>
</Layout>


<button class='hidden left w-11 h-11 rounded-full fixed bg-white top-[50%] left-[2vw] z-[80]'></button>        
<button class='hidden right w-11 h-11 rounded-full fixed bg-white top-[50%] right-[2vw] z-[80]'></button>   

<div class="hidden image-container fixed top-0 w-full overflow-auto justify-center z-[70]">
    
    <div class="parent h-[100vh] relative pt-[5rem] z-[70]">
        <div class="flex justify-center items-center pb-[5rem] overflow-auto max-w-[50rem]">
            <img class="enlarged-image object-contain" src={imgs[0]} alt="">    
        </div>
    </div>    
            
    <div data-imgArray={imgArrayData} data-length = {imgs.length} class="hidden enlarged-view fixed bg-black bg-opacity-60 inset-0 z-[60] justify-center items-center"></div>

</div>


<script is:inline>
    const images = document.querySelectorAll('.image');
    let imgIndex = 0;
    let active = false;
    
    const view = document.querySelector('.enlarged-view')
    const imageContainer = document.querySelector('.image-container');
    const left = document.querySelector('.left')
    const right = document.querySelector('.right')
    const enlargedImage = document.querySelector('.enlarged-image')

    
    const number_of_images = parseInt(view.dataset.length)
    const last_index = parseInt(number_of_images-1)
    
    let imgArrayData = view.dataset.imgarray;
    let imageArray = JSON.parse(imgArrayData)   

    const enlargeView = new Event('view')
    const closeView = new Event('close')
    const changeImage = new Event('change')

    for(let image of images){
        image.addEventListener('click', (e)=>{
            imgIndex = e.target.dataset.index
            
            active = false
            view.dispatchEvent(enlargeView)
            console.log(imgIndex)
        })
    }

    right.addEventListener('click', ()=>{
        if(imgIndex == last_index){
            imgIndex = 0
            enlargedImage.dispatchEvent(changeImage)
            return;
        }

        imgIndex++
        enlargedImage.dispatchEvent(changeImage)
    })
    left.addEventListener('click', ()=>{
        console.log('img index is', imgIndex)
        if(imgIndex == 0){
            imgIndex = last_index
            enlargedImage.dispatchEvent(changeImage)
            return;
        } else {
            imgIndex--
            enlargedImage.dispatchEvent(changeImage)
        }
    })

    view.addEventListener('view', ()=>{
        view.style.display = 'block'
        imageContainer.style.display = 'flex'   
        enlargedImage.src = imageArray[imgIndex]
        left.style.display = 'block'
        right.style.display = 'block'
        document.body.style.overflowY = 'hidden'
    })


    view.addEventListener('close',()=>{
        console.log('close view')
        view.style.display = 'none'
        imageContainer.style.display = 'none'
        left.style.display = 'none'
        right.style.display = 'none'
        console.log(view.style.display)
        document.body.style.overflowY = 'auto'
    })


    view.addEventListener('click',()=>{
        view.dispatchEvent(closeView)
    })

    enlargedImage.addEventListener('change', ()=>{
        console.log(imgIndex)
        enlargedImage.src = imageArray[imgIndex]
    })

    

   const height = imageContainer.
   console.log(height)

</script>

<style> 


</style>